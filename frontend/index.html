<!DOCTYPE html>
<html>
<head>
  <title>Resume Query UI</title>
  <style>
    body { margin: 30px; font-family: Arial; max-width: 900px; }
    input, button { padding: 8px; width: 100%; margin: 6px 0; }
    .result { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>

<body>
<h2>Upload Resume</h2>
<input id="name" placeholder="Name">
<input id="rtype" placeholder="Resume Type">
<input id="role" placeholder="Occupation">
<input type="file" id="file">
<button onclick="upload()">Upload</button>
<pre id="uploadResult"></pre>

<hr>

<h2>Search Resumes</h2>
<input id="qname" placeholder="Name">
<input id="qrtype" placeholder="Resume Type">
<input id="qrole" placeholder="Occupation">
<button onclick="search()">Search</button>

<div id="results"></div>

<script>
const BACKEND = "http://localhost:8001";
async function search() {
  const name = document.getElementById("qname").value.trim();
  const resumetype = document.getElementById("qrtype").value.trim();
  let occupation = document.getElementById("qrole").value.trim();

  if (occupation) {
    occupation = occupation.split(",").map(o => o.trim()).join(",");
  }

  const body = {
    name: name || undefined,
    resumetype: resumetype || undefined,
    occupation: occupation || undefined
  };

  const r = await fetch(`${BACKEND}/search`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  const data = await r.json();
  const div = document.getElementById("results");
  div.innerHTML = "";

  if (!data || data.length === 0) {
    div.innerHTML = "<p>No resumes found for this query.</p>";
    return;
  }

  data.forEach(x => {
    div.innerHTML += `
      <div class="result">
        <b>${x.name} - ${x.occupation}</b><br>
        ${x.filename}<br>
        <a href="${BACKEND}/document/${x.chroma_id}" target="_blank">Open Document</a>
      </div>`;
  });
}

</script>
</body>
</html>
