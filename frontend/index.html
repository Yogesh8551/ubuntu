<!DOCTYPE html>
<html>
<head>
  <title>Resume Query UI</title>
  <style>
    body { margin: 30px; font-family: Arial; max-width: 900px; }
    input, button { padding: 8px; width: 100%; margin: 6px 0; }
    .result { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>

<body>
<h2>Upload Resume</h2>

<input id="name" placeholder="Name">
<input id="rtype" placeholder="Resume Type">
<input id="role" placeholder="Occupation">
<input type="file" id="file">

<button onclick="upload()">Upload</button>
<pre id="uploadResult"></pre>

<hr>

<h2>Search Resumes</h2>
<input id="qname" placeholder="Name">
<input id="qrtype" placeholder="Resume Type">
<input id="qrole" placeholder="Occupation">
<button onclick="search()">Search</button>

<div id="results"></div>

<script>
const BACKEND = "http://localhost:8001";

async function upload() {
  const fd = new FormData();
  fd.append("name", document.getElementById("name").value)
  fd.append("resumetype", document.getElementById("rtype").value)
  fd.append("occupation", document.getElementById("role").value)
  fd.append("file", document.getElementById("file").files[0])

  const r = await fetch(`${BACKEND}/ingest`, { method: "POST", body: fd });
  document.getElementById("uploadResult").innerText =
    JSON.stringify(await r.json(), null, 2);
}
async function search() {
  const params = new URLSearchParams();
  params.append("name", document.getElementById("qname").value);
  params.append("resumetype", document.getElementById("qrtype").value);
  params.append("occupation", document.getElementById("qrole").value);

  const r = await fetch(`${BACKEND}/search`, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: params
  });

  const data = await r.json();

  const div = document.getElementById("results");
  div.innerHTML = "";

  data.forEach(x => {
    div.innerHTML += `
      <div class="result">
        <b>${x.name} - ${x.occupation}</b><br>
        ${x.filename}<br>
        <a href="${BACKEND}/document/${x.chroma_id}" target="_blank">Open Document</a>
      </div>`;
  });
}

</script>
</body>
</html>
